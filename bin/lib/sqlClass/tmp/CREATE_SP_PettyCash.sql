CREATE PROCEDURE Incremental_push_PettyCash
AS
IF (EXISTS (
	SELECT * FROM INFORMATION_SCHEMA.TABLES
	WHERE TABLE_CATALOG = '[min-project]' 
	AND TABLE_SCHEMA = 'dbo' 
	AND TABLE_TYPE = 'BASE TABLE' 
	AND TABLE_NAME = 'PettyCash'
) ) 
BEGIN 
	INSERT INTO PettyCash (
		[RefKey],
	[TransactionID],
	[BranchID],
	[InvoiceNo],
	[InvoiceDate],
	[VenderNo],
	[Amount],
	[CurrencyCode],
	[TermsID],
	[Detail],
	[Source],
	[PaymentMethod],
	[PaymentGroup],
	[GLDate],
	[AcctPayCodeCombinationID],
	[OrgID],
	[TermsDate],
	[LineNo],
	[LineType],
	[AmountBV],
	[AmountAV],
	[LineDetail],
	[AccountCode],
	[TaxClassificationCode],
	[CrTime],
	[UTime],
	[ImportTime],
	[BPC_status],
	[BPC_Remark],
	[BPC_StatusDatetime]
	) SELECT 
		[RefKey],
	[TransactionID],
	[BranchID],
	[InvoiceNo],
	[InvoiceDate],
	[VenderNo],
	[Amount],
	[CurrencyCode],
	[TermsID],
	[Detail],
	[Source],
	[PaymentMethod],
	[PaymentGroup],
	[GLDate],
	[AcctPayCodeCombinationID],
	[OrgID],
	[TermsDate],
	[LineNo],
	[LineType],
	[AmountBV],
	[AmountAV],
	[LineDetail],
	[AccountCode],
	[TaxClassificationCode],
	[CrTime],
	[UTime],
	[ImportTime],
	[BPC_status],
	[BPC_Remark],
	[BPC_StatusDatetime]
	FROM [43.254.133.155].[ITECToAX].[dbo].PettyCash
	WHERE UTime > (SELECT MAX(UTime) FROM [dbo].PettyCash)
END
ELSE BEGIN 
	CREATE TABLE PettyCash (
		[RefKey] bigint,
	[TransactionID] int,
	[BranchID] int,
	[InvoiceNo] varchar(300),
	[InvoiceDate] datetime,
	[VenderNo] varchar(300),
	[Amount] money,
	[CurrencyCode] varchar(50),
	[TermsID] money,
	[Detail] varchar(MAX),
	[Source] varchar(100),
	[PaymentMethod] varchar(100),
	[PaymentGroup] varchar(100),
	[GLDate] datetime,
	[AcctPayCodeCombinationID] varchar(100),
	[OrgID] int,
	[TermsDate] datetime,
	[LineNo] int,
	[LineType] varchar(100),
	[AmountBV] money,
	[AmountAV] money,
	[LineDetail] varchar(MAX),
	[AccountCode] varchar(100),
	[TaxClassificationCode] varchar(100),
	[CrTime] datetime,
	[UTime] datetime,
	[ImportTime] datetime,
	[BPC_status] int,
	[BPC_Remark] varchar(MAX),
	[BPC_StatusDatetime] datetime
	)
	
	INSERT INTO PettyCash (
		[RefKey],
	[TransactionID],
	[BranchID],
	[InvoiceNo],
	[InvoiceDate],
	[VenderNo],
	[Amount],
	[CurrencyCode],
	[TermsID],
	[Detail],
	[Source],
	[PaymentMethod],
	[PaymentGroup],
	[GLDate],
	[AcctPayCodeCombinationID],
	[OrgID],
	[TermsDate],
	[LineNo],
	[LineType],
	[AmountBV],
	[AmountAV],
	[LineDetail],
	[AccountCode],
	[TaxClassificationCode],
	[CrTime],
	[UTime],
	[ImportTime],
	[BPC_status],
	[BPC_Remark],
	[BPC_StatusDatetime]
	) 
	SELECT 
        [RefKey],
	[TransactionID],
	[BranchID],
	[InvoiceNo],
	[InvoiceDate],
	[VenderNo],
	[Amount],
	[CurrencyCode],
	[TermsID],
	[Detail],
	[Source],
	[PaymentMethod],
	[PaymentGroup],
	[GLDate],
	[AcctPayCodeCombinationID],
	[OrgID],
	[TermsDate],
	[LineNo],
	[LineType],
	[AmountBV],
	[AmountAV],
	[LineDetail],
	[AccountCode],
	[TaxClassificationCode],
	[CrTime],
	[UTime],
	[ImportTime],
	[BPC_status],
	[BPC_Remark],
	[BPC_StatusDatetime]
	FROM [43.254.133.155].[ITECToAX].[dbo].PettyCash
END