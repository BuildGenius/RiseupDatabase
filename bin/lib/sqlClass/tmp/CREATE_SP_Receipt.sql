CREATE PROCEDURE Incremental_push_Receipt
AS
IF (EXISTS (
	SELECT * FROM INFORMATION_SCHEMA.TABLES
	WHERE TABLE_CATALOG = '[min-project]' 
	AND TABLE_SCHEMA = 'dbo' 
	AND TABLE_TYPE = 'BASE TABLE' 
	AND TABLE_NAME = 'Receipt'
) ) 
BEGIN 
	INSERT INTO Receipt (
		[RefKey],
	[TransactionID],
	[ReceiptType],
	[ReceiptID],
	[ReceiptBranch],
	[ReceiptMethod],
	[ReceiptDate],
	[Amount],
	[EDCNo],
	[TransferBankID],
	[TransferBankName],
	[TransferBankAccountNo],
	[ChequeNo],
	[DepositID],
	[DepositBranch],
	[SlipNo],
	[CCNo],
	[SellID],
	[SellBranch],
	[Remark],
	[CrTime],
	[UTime],
	[ImportTime],
	[BPC_status],
	[BPC_Remark],
	[BPC_StatusDatetime]
	) SELECT 
		[RefKey],
	[TransactionID],
	[ReceiptType],
	[ReceiptID],
	[ReceiptBranch],
	[ReceiptMethod],
	[ReceiptDate],
	[Amount],
	[EDCNo],
	[TransferBankID],
	[TransferBankName],
	[TransferBankAccountNo],
	[ChequeNo],
	[DepositID],
	[DepositBranch],
	[SlipNo],
	[CCNo],
	[SellID],
	[SellBranch],
	[Remark],
	[CrTime],
	[UTime],
	[ImportTime],
	[BPC_status],
	[BPC_Remark],
	[BPC_StatusDatetime]
	FROM [43.254.133.155].[ITECToAX].[dbo].Receipt
	WHERE UTime > (SELECT MAX(UTime) FROM [dbo].Receipt)
END
ELSE BEGIN 
	CREATE TABLE Receipt (
		[RefKey] bigint,
	[TransactionID] int,
	[ReceiptType] int,
	[ReceiptID] int,
	[ReceiptBranch] int,
	[ReceiptMethod] int,
	[ReceiptDate] datetime,
	[Amount] money,
	[EDCNo] varchar(20),
	[TransferBankID] int,
	[TransferBankName] varchar(200),
	[TransferBankAccountNo] varchar(50),
	[ChequeNo] varchar(20),
	[DepositID] int,
	[DepositBranch] int,
	[SlipNo] varchar(20),
	[CCNo] varchar(20),
	[SellID] int,
	[SellBranch] int,
	[Remark] varchar(300),
	[CrTime] datetime,
	[UTime] datetime,
	[ImportTime] datetime,
	[BPC_status] int,
	[BPC_Remark] varchar(MAX),
	[BPC_StatusDatetime] datetime
	)
	
	INSERT INTO Receipt (
		[RefKey],
	[TransactionID],
	[ReceiptType],
	[ReceiptID],
	[ReceiptBranch],
	[ReceiptMethod],
	[ReceiptDate],
	[Amount],
	[EDCNo],
	[TransferBankID],
	[TransferBankName],
	[TransferBankAccountNo],
	[ChequeNo],
	[DepositID],
	[DepositBranch],
	[SlipNo],
	[CCNo],
	[SellID],
	[SellBranch],
	[Remark],
	[CrTime],
	[UTime],
	[ImportTime],
	[BPC_status],
	[BPC_Remark],
	[BPC_StatusDatetime]
	) 
	SELECT 
        [RefKey],
	[TransactionID],
	[ReceiptType],
	[ReceiptID],
	[ReceiptBranch],
	[ReceiptMethod],
	[ReceiptDate],
	[Amount],
	[EDCNo],
	[TransferBankID],
	[TransferBankName],
	[TransferBankAccountNo],
	[ChequeNo],
	[DepositID],
	[DepositBranch],
	[SlipNo],
	[CCNo],
	[SellID],
	[SellBranch],
	[Remark],
	[CrTime],
	[UTime],
	[ImportTime],
	[BPC_status],
	[BPC_Remark],
	[BPC_StatusDatetime]
	FROM [43.254.133.155].[ITECToAX].[dbo].Receipt
END